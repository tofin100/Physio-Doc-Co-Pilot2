<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Physio Doc Co-Pilot ‚Äì Pilot</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="Pilot einer browserbasierten Physio-Dokumentationshilfe: strukturierte Doku in unter 60 Sekunden, alle Daten bleiben lokal im Browser."
  />
  <meta name="theme-color" content="#0b1020" />

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app-root">
    <!-- Header -->
    <header class="app-header">
      <div class="app-header-left">
        <h1 class="app-title">
          Physio Doc Co-Pilot
          <span class="app-badge">Pilot</span>
        </h1>
        <p class="app-subtitle">
          ICD-10 eingeben, kurz klicken, Doku generieren ‚Äì alle Daten bleiben lokal im Browser.
        </p>
      </div>
      <div class="app-header-right">
        <span id="speech-status-indicator" class="status-indicator" aria-live="polite">
          Mikrofon nicht aktiv
        </span>
      </div>
    </header>

    <!-- Main -->
    <main class="app-main" aria-label="Physio Doc Co-Pilot Oberfl√§che">
      <!-- Sidebar -->
      <aside class="sidebar" aria-label="Patientenverwaltung">
        <section class="panel panel-patients">
          <header class="panel-header">
            <h2 class="panel-title">Patienten</h2>
          </header>

          <!-- Liste -->
          <ul id="patient-list" class="list patient-list" aria-label="Patientenliste">
            <!-- per JS -->
          </ul>

          <div class="panel-divider" role="separator" aria-hidden="true"></div>

          <!-- Neuer Patient -->
          <section class="new-patient-section" aria-label="Neuen Patienten anlegen">
            <h3 class="panel-subtitle">Neuer Patient</h3>

            <form id="new-patient-form" class="form form-vertical" autocomplete="off">
              <div class="form-field">
                <label for="patient-name-input">
                  Name <span class="field-hint">(Pflichtfeld)</span>
                </label>
                <input
                  type="text"
                  id="patient-name-input"
                  required
                  placeholder="z. B. Max Mustermann"
                />
              </div>

              <div class="form-field">
                <label for="patient-year-input">
                  Geburtsjahr <span class="field-hint">(optional)</span>
                </label>
                <input
                  type="number"
                  id="patient-year-input"
                  min="1900"
                  max="2100"
                  inputmode="numeric"
                  placeholder="1985"
                />
              </div>

              <!-- ICD-10 Hauptdiagnose -->
              <div class="form-field">
                <label for="patient-icd-input">
                  ICD-10 Hauptdiagnose
                  <span class="field-hint">(Pflichtfeld, z. B. M54.5)</span>
                </label>
                <input
                  type="text"
                  id="patient-icd-input"
                  placeholder="z. B. M54.5 Kreuzschmerz"
                  autocomplete="off"
                  required
                />
                <div
                  id="patient-icd-suggestions"
                  class="icd-suggestions"
                  aria-label="ICD-10 Vorschl√§ge"
                ></div>
                <p id="patient-icd-selected" class="icd-selected">
                  Noch keine Diagnose ausgew√§hlt.
                </p>
                <p class="icd-helper-text">
                  Tipp: Code oder Text eingeben (z.&nbsp;B. ‚ÄûM54‚Äú oder ‚ÄûSchulter‚Äú) und Vorschlag ausw√§hlen.
                </p>
              </div>

              <button type="submit" class="btn btn-primary btn-full">
                Schnell anlegen & Erstbefund starten
              </button>
            </form>
          </section>
        </section>
      </aside>

      <!-- Hauptbereich -->
      <section class="main-content">
        <!-- Kein Patient ausgew√§hlt -->
        <section id="no-patient-selected" class="empty-state" aria-live="polite">
          <h2 class="empty-title">Willkommen üëã</h2>
          <p class="empty-text">
            Lege links einen Patienten mit ICD-10-Hauptdiagnose an ‚Äì wir starten automatisch mit einem Erstbefund mit heutigem Datum.
          </p>
          <p class="empty-text secondary">
            Dies ist eine Pilotversion: alle Daten werden ausschlie√ülich lokal in deinem Browser gespeichert.
          </p>
        </section>

        <!-- Patient ausgew√§hlt -->
        <section
          id="patient-detail"
          class="patient-detail hidden"
          aria-live="polite"
          aria-label="Details zum ausgew√§hlten Patienten"
        >
          <!-- Kopf -->
          <header class="panel patient-header">
            <div class="patient-header-info">
              <h2 id="patient-title" class="patient-name"></h2>
              <p id="patient-meta" class="patient-meta"></p>
            </div>
            <div class="patient-header-actions">
              <button id="add-session-btn" class="btn btn-secondary" type="button">
                + Folgetermin
              </button>
            </div>
          </header>

          <!-- Layout -->
          <div class="patient-layout">
            <!-- Verlauf -->
            <section class="panel sessions-panel" aria-label="Sitzungen & Verlauf">
              <header class="panel-header">
                <h3 class="panel-title">Sitzungen & Verlauf</h3>
              </header>

              <ul id="session-list" class="list session-list" aria-label="Liste der Sitzungen">
                <!-- per JS -->
              </ul>

              <div class="score-chart-wrapper">
                <canvas
                  id="score-chart"
                  class="score-chart"
                  width="400"
                  height="200"
                  aria-label="Verlauf des Beschwerde-Scores"
                  role="img"
                >
                  Dein Browser unterst√ºtzt kein Canvas ‚Äì Score-Verlauf nicht verf√ºgbar.
                </canvas>
              </div>
            </section>

            <!-- Editor -->
            <section class="panel editor-panel" aria-label="Sitzung dokumentieren">
              <!-- Kein Termin -->
              <div id="no-session-selected" class="empty-state small">
                <p class="empty-text">
                  Noch keine Sitzung ausgew√§hlt. Lege links einen Patienten an ‚Äì wir starten automatisch mit einer Erstbefund-Sitzung.
                </p>
              </div>

              <!-- Editor -->
              <div id="session-editor" class="session-editor hidden">
                <!-- Steps -->
                <div class="editor-steps">
                  <span class="step-badge">1</span> Beschwerden w√§hlen
                  <span class="step-separator">‚Üí</span>
                  <span class="step-badge">2</span> Ma√ünahmen anklicken
                  <span class="step-separator">‚Üí</span>
                  <span class="step-badge">3</span> Doku generieren &amp; kopieren
                </div>

                <!-- Basisinfos -->
                <div class="editor-row editor-row-inline">
                  <div class="form-field">
                    <label for="session-type">Sitzungstyp</label>
                    <select id="session-type">
                      <option value="initial">Erstbefund</option>
                      <option value="followup">Folgetermin</option>
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="session-date">Datum</label>
                    <input type="date" id="session-date" />
                  </div>
                </div>

                <!-- Beschwerden -->
                <div class="editor-row">
                  <div class="chip-group">
                    <div class="chip-group-header">
                      <span class="chip-group-title">Beschwerden</span>
                      <span class="chip-group-hint">Mehrfachauswahl m√∂glich</span>
                    </div>
                    <div id="complaint-chips" class="chips"></div>
                  </div>
                </div>

                <!-- Ma√ünahmen -->
                <div class="editor-row">
                  <div class="chip-group">
                    <div class="chip-group-header">
                      <span class="chip-group-title">Ma√ünahmen</span>
                      <span class="chip-group-hint">heutige Behandlung</span>
                    </div>
                    <div id="measure-chips" class="chips"></div>
                  </div>
                </div>

                <!-- Skalen -->
                <div class="editor-row sliders-row">
                  <div class="slider-block">
                    <label for="pain-slider">
                      Schmerz (0 = kein, 10 = maximal)
                    </label>
                    <div class="slider-value-row">
                      <input
                        type="range"
                        id="pain-slider"
                        min="0"
                        max="10"
                        step="1"
                        value="5"
                      />
                      <span id="pain-value" class="slider-value" aria-live="polite">5</span>
                    </div>
                  </div>

                  <div class="slider-block">
                    <label for="function-slider">
                      Alltags¬≠einschr√§nkung (0 = keine, 10 = maximal)
                    </label>
                    <div class="slider-value-row">
                      <input
                        type="range"
                        id="function-slider"
                        min="0"
                        max="10"
                        step="1"
                        value="5"
                      />
                      <span id="function-value" class="slider-value" aria-live="polite">5</span>
                    </div>
                  </div>
                </div>

                <!-- Sprache / Transkription in Reitern -->
                <div class="editor-row speech-row">
                  <div class="speech-controls">
                    <!-- Globaler Button: startet/stoppt Aufnahme f√ºr das aktuell aktive Feld -->
                    <button id="speech-toggle-btn" type="button" class="btn btn-secondary">
                      üéôÔ∏è Aufnahme starten (aktiver Bereich)
                    </button>
                    <span id="speech-hint" class="speech-hint">
                      Bereich w√§hlen (‚ÄûAufnahme f√ºr diesen Bereich‚Äú) und dann hier Start/Stop dr√ºcken.
                    </span>
                  </div>

                  <!-- Reiter -->
                  <div class="speech-tabs">
                    <button type="button" class="speech-tab active" data-target="speech-tab-anamnese">
                      Anamnese
                    </button>
                    <button type="button" class="speech-tab" data-target="speech-tab-befund">
                      Aktueller Befund / Status
                    </button>
                    <button type="button" class="speech-tab" data-target="speech-tab-diagnose">
                      Diagnose (physiotherapeutisch / √§rztlich)
                    </button>
                    <button type="button" class="speech-tab" data-target="speech-tab-therapieplan">
                      Therapievorschlag / Therapieplan
                    </button>
                    <button type="button" class="speech-tab" data-target="speech-tab-verlauf">
                      Verlauf &amp; Dokumentation
                    </button>
                    <button type="button" class="speech-tab" data-target="speech-tab-epikrise">
                      Epikrise / Bewertung / Empfehlung
                    </button>
                  </div>

                  <div class="speech-tab-panels">
                    <!-- Anamnese -->
                    <div class="form-field speech-tab-panel active" id="speech-tab-anamnese">
                      <div class="speech-panel-header">
                        <div>
                          <div class="speech-panel-title">Anamnese</div>
                          <span class="field-hint">
                            Vorgeschichte der Beschwerden, fr√ºhere Erkrankungen, bisherige Behandlungen, Fach√§rzte.
                          </span>
                        </div>
                        <button
                          type="button"
                          class="btn btn-secondary speech-record-btn"
                          data-target-textarea="speech-anamnese"
                        >
                          üéôÔ∏è Aufnahme f√ºr diesen Bereich
                        </button>
                      </div>
                      <textarea
                        id="speech-anamnese"
                        rows="3"
                        placeholder="Anamnese-Notizen oder Transkript"
                      ></textarea>
                    </div>

                    <!-- Aktueller Befund / Status -->
                    <div class="form-field speech-tab-panel" id="speech-tab-befund">
                      <div class="speech-panel-header">
                        <div>
                          <div class="speech-panel-title">Aktueller Befund / Status</div>
                          <span class="field-hint">
                            Beschreibung der aktuellen Beschwerden, k√∂rperlichen Befunde, Beweglichkeit, Schmerzbild, Funktionsst√∂rungen.
                          </span>
                        </div>
                        <button
                          type="button"
                          class="btn btn-secondary speech-record-btn"
                          data-target-textarea="speech-befund"
                        >
                          üéôÔ∏è Aufnahme f√ºr diesen Bereich
                        </button>
                      </div>
                      <textarea
                        id="speech-befund"
                        rows="3"
                        placeholder="Befund-Notizen oder Transkript"
                      ></textarea>
                    </div>

                    <!-- Diagnose -->
                    <div class="form-field speech-tab-panel" id="speech-tab-diagnose">
                      <div class="speech-panel-header">
                        <div>
                          <div class="speech-panel-title">
                            Diagnose (physiotherapeutisch / √§rztlich)
                          </div>
                          <span class="field-hint">
                            Physiotherapeutische Einsch√§tzung in Anlehnung an die √§rztliche ICD-10-Diagnose.
                          </span>
                        </div>
                        <button
                          type="button"
                          class="btn btn-secondary speech-record-btn"
                          data-target-textarea="speech-diagnose"
                        >
                          üéôÔ∏è Aufnahme f√ºr diesen Bereich
                        </button>
                      </div>
                      <textarea
                        id="speech-diagnose"
                        rows="3"
                        placeholder="Diagnose / Einsch√§tzung"
                      ></textarea>
                    </div>

                    <!-- Therapievorschlag / Therapieplan -->
                    <div class="form-field speech-tab-panel" id="speech-tab-therapieplan">
                      <div class="speech-panel-header">
                        <div>
                          <div class="speech-panel-title">Therapievorschlag / Therapieplan</div>
                          <span class="field-hint">
                            Geplante therapeutische Ma√ünahmen (KG, MT, √úbungen ‚Ä¶), H√§ufigkeit, Ziele.
                          </span>
                        </div>
                        <button
                          type="button"
                          class="btn btn-secondary speech-record-btn"
                          data-target-textarea="speech-therapieplan"
                        >
                          üéôÔ∏è Aufnahme f√ºr diesen Bereich
                        </button>
                      </div>
                      <textarea
                        id="speech-therapieplan"
                        rows="3"
                        placeholder="Therapieplan / geplante Ma√ünahmen"
                      ></textarea>
                    </div>

                    <!-- Verlauf & Dokumentation -->
                    <div class="form-field speech-tab-panel" id="speech-tab-verlauf">
                      <div class="speech-panel-header">
                        <div>
                          <div class="speech-panel-title">
                            Verlauf &amp; Dokumentation der durchgef√ºhrten Sitzungen / Therapien
                          </div>
                          <span class="field-hint">
                            Was wurde gemacht, wie hat sich der Zustand ver√§ndert, Zwischenbefunde.
                          </span>
                        </div>
                        <button
                          type="button"
                          class="btn btn-secondary speech-record-btn"
                          data-target-textarea="speech-verlauf"
                        >
                          üéôÔ∏è Aufnahme f√ºr diesen Bereich
                        </button>
                      </div>
                      <textarea
                        id="speech-verlauf"
                        rows="3"
                        placeholder="Verlauf / Zwischenergebnisse"
                      ></textarea>
                    </div>

                    <!-- Epikrise / Bewertung / Empfehlung -->
                    <div class="form-field speech-tab-panel" id="speech-tab-epikrise">
                      <div class="speech-panel-header">
                        <div>
                          <div class="speech-panel-title">
                            Epikrise / Bewertung / Empfehlung
                          </div>
                          <span class="field-hint">
                            Abschlie√üende Beurteilung des bisherigen Verlaufs, Empfehlungen f√ºr weitere Ma√ünahmen.
                          </span>
                        </div>
                        <button
                          type="button"
                          class="btn btn-secondary speech-record-btn"
                          data-target-textarea="speech-epikrise"
                        >
                          üéôÔ∏è Aufnahme f√ºr diesen Bereich
                        </button>
                      </div>
                      <textarea
                        id="speech-epikrise"
                        rows="3"
                        placeholder="Epikrise / Bewertung / Empfehlung"
                      ></textarea>
                    </div>
                  </div>

                  <!-- Gesamt-Transkript (Kompatibilit√§t zu alter Logik) -->
                  <div class="form-field">
                    <label for="speech-notes">
                      Gesamt-Transkript / Stichworte
                      <span class="field-hint">
                        Optional: gesamter Text, falls du nur ein Feld nutzen m√∂chtest.
                      </span>
                    </label>
                    <textarea
                      id="speech-notes"
                      rows="2"
                      placeholder="Gesamtes Roh-Transkript, falls ben√∂tigt."
                    ></textarea>
                  </div>
                </div>

                <!-- Generierte Doku -->
                <div class="editor-row">
                  <div class="form-field">
                    <label for="session-note">
                      Generierte Doku <span class="field-hint">(editierbar)</span>
                    </label>
                    <textarea
                      id="session-note"
                      rows="10"
                      class="note-textarea"
                      placeholder="Klicke auf ‚ÄûDoku generieren‚Äú ‚Äì die Notiz kannst du anschlie√üend anpassen."
                    ></textarea>
                  </div>
                </div>

                <!-- Footer -->
                <div class="editor-footer">
                  <div class="score-block" aria-label="Beschwerde-Score">
                    <div class="score-label">Beschwerde-Score</div>
                    <div id="score-value" class="score-value">‚Äì</div>
                    <div id="score-category" class="score-category">
                      Noch nicht berechnet
                    </div>
                  </div>
                  <div class="editor-actions">
                    <button id="generate-note-btn" class="btn btn-secondary" type="button">
                      Doku generieren
                    </button>
                    <button id="copy-note-btn" class="btn btn-secondary" type="button">
                      In Zwischenablage kopieren
                    </button>
                    <button id="save-session-btn" class="btn btn-primary" type="button">
                      Sitzung speichern
                    </button>
                    <button id="delete-session-btn" class="btn btn-danger" type="button">
                      Sitzung l√∂schen
                    </button>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </section>
      </section>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
      <p class="footer-text">
        Physio Doc Co-Pilot ¬∑ Pilotversion ¬∑ alle Daten bleiben lokal im Browser.
      </p>
    </footer>
  </div>

  <!-- ICD-10 Daten (eigene Datei) + App-Logik -->
  <script src="./icd10-codes.js" defer></script>
  <script src="./app.js" defer></script>
</body>
</html>